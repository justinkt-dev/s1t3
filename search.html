<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no" />
  <title>Search | Justin Kombe T.</title>
  <link rel="stylesheet" href="./static/css/style.css" />
  <link rel="stylesheet" href="./static/css/mediaqueries.css" />
</head>
<body>
  <header>
    <nav id="desktop-nav">
      <div class="logo">
        <a href="/" class="logo-wrapper">
          <!-- <img src="./assets/home_light.webp" src-light="./assets/home_light.webp" src-dark="./assets/home_light.webp" alt="Home Logo" class="icon logo-icon" /> -->
          <span class="home-nav-link" style="font-size: 1.2rem; font-weight: 600; color: var(--text-primary); text-decoration: none; display: inline-block; padding: 8px 14px; border-radius: 999px; border: 1px solid transparent; transition: all 0.3s ease; cursor: pointer;">Home</span>
        </a>
      </div>

      <div>
        <ul class="nav-links">
          <li><a href="/blog.html">Blog</a></li>
          <li><a href="/about.html">About</a></li>
          <li><a href="/search.html" class="active">üîç</a></li>
          <li>
            <img id="modeToggle" class="icon color-icon" src="./assets/theme_light.png"
              src-light="./assets/theme_light.png" src-dark="./assets/theme_dark.png" alt="Color theme icon" />
          </li>
        </ul>
      </div>
    </nav>
  </header>

  <nav id="hamburger-nav">
    <div class="logo">
      <a href="/" class="logo-wrapper">
        <img src="./assets/home_light.webp" src-light="./assets/home_light.webp" src-dark="./assets/home_light.webp"
          alt="Home Logo" class="icon logo-icon" />
        <span>Justin Kombe T.</span>
      </a>
    </div>
    <div class="hamburger-menu">
      <div class="hamburger-icon" onclick="toggleMenu()">
        <span></span>
        <span></span>
        <span></span>
      </div>
      <div class="menu-links">
        <li><a href="/">Home</a></li>
        <li><a href="/blog.html">Blog</a></li>
        <li><a href="/about.html">About</a></li>
        <li><a href="/search.html" class="active">üîç</a></li>
        <li>
          <img id="modeToggle2" class="icon color-icon" src="./assets/theme_light.png"
            src-light="./assets/theme_light.png" src-dark="./assets/theme_dark.png" alt="Color theme icon" />
        </li>
      </div>
    </div>
  </nav>

  <main style="margin-top:56px; padding:2rem 1rem; min-height:calc(100vh - 56px - 60px); display:flex; flex-direction:column;">
    <section class="card" style="max-width:1100px;margin:0 auto;padding:1.5rem; flex:1;">
      <h1 class="title" style="text-align:left;margin-bottom:1rem;">Search</h1>
      <div style="display:flex;gap:.5rem;align-items:center;">
        <input id="search-input" type="search" placeholder="Enter a term (e.g., Linux, ldmtool, ProLabs)" style="flex:1;padding:.8rem 1rem;border:1px solid var(--border-color);border-radius:10px;background:var(--bg-primary);color:var(--text-primary);" />
        <button id="search-btn" class="btn btn-color-2" style="width:auto;">üîç</button>
      </div>
      <div id="search-meta" style="margin:.75rem 0;color:var(--text-secondary);"></div>
      <div id="search-results" style="display:flex;flex-direction:column;gap:12px;"></div>
    </section>
  </main>

  <footer style="margin-top:auto; padding:1rem 0; background:var(--bg-secondary); border-top:1px solid var(--border-color);">
    <p style="text-align:center; color:var(--text-secondary); font-size:0.85rem; margin:0;">Copyright &#169; 2025 Justin Kombe Tonguino.</p>
  </footer>

  <script src="./static/js/main.js"></script>
  <script src="./static/js/search-config.js"></script>
  <script>
    // Initialize dynamic search system
    let searchIndex;
    let currentCategory = null;

    function excerpt(html, query) {
      const text = html.replace(/<[^>]+>/g, ' ');
      const q = query.toLowerCase();
      const idx = text.toLowerCase().indexOf(q);
      if (idx === -1) return '';
      const start = Math.max(0, idx - 80);
      const end = Math.min(text.length, idx + q.length + 80);
      const snippet = text.slice(start, end).trim();
      return snippet.replace(new RegExp(query, 'ig'), m => `**${m}**`);
    }

    async function runSearch() {
      const q = document.getElementById('search-input').value.trim();
      const meta = document.getElementById('search-meta');
      const out = document.getElementById('search-results');
      out.innerHTML = '';
      
      if (!q) { 
        meta.textContent = ''; 
        return; 
      }
      
      if (!searchIndex) {
        meta.textContent = 'Search index not loaded yet...';
        return;
      }
      
      // Show loading state
      meta.textContent = 'Searching...';
      
      try {
        const results = await searchIndex.search(q, currentCategory);
        
        if (results.length === 0) {
          meta.textContent = `No results found for "${q}"`;
          return;
        }
        
        // Display results
        for (const result of results) {
          const card = document.createElement('a');
          card.href = result.url;
          card.className = 'card interactive-row';
          card.style.padding = '1rem';
          card.style.textDecoration = 'none';
          card.style.color = 'inherit';
          
          // Get content excerpt
          const res = await fetch(result.fetch);
          const html = await res.text();
          const snip = excerpt(html, q);
          
          // Add category badge
          const categoryBadge = result.category && result.category !== 'core' 
            ? `<span style="background: var(--accent-primary); color: var(--bg-primary); padding: 2px 8px; border-radius: 12px; font-size: 0.75rem; margin-right: 8px;">${searchIndex.getCategories()[result.category] || result.category}</span>`
            : '';
          
          // Add match type indicator
          const matchIndicator = result.matchType === 'keyword' 
            ? `<span style="color: var(--accent-secondary); font-size: 0.8rem;">‚òÖ</span>`
            : '';
          
          card.innerHTML = `
            <div style="font-weight:700;margin-bottom:.25rem;display:flex;align-items:center;">
              ${categoryBadge}${result.title} ${matchIndicator}
            </div>
            <div style="color:var(--text-secondary);font-size:.95rem;">
              ${snip || 'Match found on this page.'}
            </div>
          `;
          out.appendChild(card);
        }
        
        meta.textContent = `${results.length} result${results.length===1?'':'s'} for "${q}"`;
        
      } catch (error) {
        console.error('Search error:', error);
        meta.textContent = 'Search failed. Please try again.';
      }
    }

    // Initialize search functionality
    document.addEventListener('DOMContentLoaded', async function() {
      // Initialize search index
      searchIndex = new SearchIndex();
      await searchIndex.discoverContent();
      
      // Add search event listeners
      document.getElementById('search-btn').addEventListener('click', runSearch);
      document.getElementById('search-input').addEventListener('keydown', (e)=>{ if(e.key==='Enter') runSearch(); });
      
      // Add real-time search as user types (with debouncing)
      let searchTimeout;
      document.getElementById('search-input').addEventListener('input', function() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(runSearch, 300); // 300ms delay
      });
      
      // Add category filter buttons (optional enhancement)
      addCategoryFilters();
    });
    
    // Add category filter buttons for better search experience
    function addCategoryFilters() {
      const searchContainer = document.querySelector('main section');
      const filterContainer = document.createElement('div');
      filterContainer.style.cssText = 'display:flex;gap:8px;margin:1rem 0;flex-wrap:wrap;';
      filterContainer.innerHTML = `
        <button class="category-filter active" data-category="">All</button>
        <button class="category-filter" data-category="certifications">Certifications</button>
        <button class="category-filter" data-category="linux">Linux</button>
        <button class="category-filter" data-category="geotech">GeoTech</button>
        <button class="category-filter" data-category="walkthroughs">Walkthroughs</button>
      `;
      
      // Style the filter buttons
      const style = document.createElement('style');
      style.textContent = `
        .category-filter {
          padding: 6px 12px;
          border: 1px solid var(--border-color);
          background: var(--bg-primary);
          color: var(--text-secondary);
          border-radius: 20px;
          cursor: pointer;
          transition: all 0.3s ease;
          font-size: 0.85rem;
        }
        .category-filter:hover {
          background: var(--bg-secondary);
          color: var(--text-primary);
        }
        .category-filter.active {
          background: var(--accent-primary);
          color: var(--bg-primary);
          border-color: var(--accent-primary);
        }
      `;
      document.head.appendChild(style);
      
      // Insert filter container after search input
      const searchInput = document.getElementById('search-input').parentElement;
      searchInput.parentNode.insertBefore(filterContainer, searchInput.nextSibling);
      
      // Add filter event listeners
      filterContainer.querySelectorAll('.category-filter').forEach(btn => {
        btn.addEventListener('click', function() {
          // Update active state
          filterContainer.querySelectorAll('.category-filter').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          
          // Update current category
          currentCategory = this.dataset.category || null;
          
          // Re-run search if there's a query
          const query = document.getElementById('search-input').value.trim();
          if (query) {
            runSearch();
          }
        });
      });
    }
  </script>
</body>
</html>

